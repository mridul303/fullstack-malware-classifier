import keras
import keras.backend as K
from keras.models import Sequential, load_model
from keras.layers import Dense, Conv2D, MaxPool2D , Flatten
from keras.optimizers import Adam
import numpy as np
import cv2


def process_image(dir_name):
        img = cv2.imread(f'{dir_name}/output.png')
        img = np.reshape(img, [1, 224, 224, 3])
        return img

def detect_malware_vgg(dir_name):
        model = load_model('./trained_models/VGG16.h5')
        img = process_image(dir_name)
        predicted = model.predict(img).tolist()
        accuracy = max(predicted[0])
        return accuracy

def detect_malware_dense(dir_name):
        model = load_model('./trained_models/densenet.h5')
        img = process_image(dir_name)
        predicted = model.predict(img).tolist()
        accuracy = max(predicted[0])
        return accuracy
